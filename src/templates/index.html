<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StrategyMasters: Izazov industrije pametnih telefona</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <div class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h1 class="text-center">StrategyMasters</h1>
                        <h3 class="text-center">Izazov industrije pametnih telefona</h3>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <p class="lead">Simulacija poslovne strategije za više igrača za MBA predavanja</p>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header bg-success text-white">
                                        <h4>Voditelj</h4>
                                    </div>
                                    <div class="card-body">
                                        <p>Kreirajte novu sesiju igre ili upravljajte postojećom</p>
                                        <button class="btn btn-success w-100 mb-2" data-bs-toggle="modal" data-bs-target="#createGameModal">Kreiraj novu igru</button>
                                        <button class="btn btn-outline-success w-100" data-bs-toggle="modal" data-bs-target="#joinAdminModal">Pridruži se kao voditelj</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header bg-info text-white">
                                        <h4>Tim</h4>
                                    </div>
                                    <div class="card-body">
                                        <p>Pridružite se postojećoj igri kao tim</p>
                                        <button class="btn btn-info w-100" data-bs-toggle="modal" data-bs-target="#joinTeamModal">Pridruži se kao tim</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mb-4">
                            <div class="card-header bg-secondary text-white">
                                <h4>O simulaciji</h4>
                            </div>
                            <div class="card-body">
                                <p>StrategyMasters: Izazov industrije pametnih telefona je simulacija poslovne strategije za više igrača namenjena MBA predavanjima. Timovi se takmiče kao proizvođači pametnih telefona na dinamičnom tržištu, donoseći strateške odluke tokom 10 rundi kako bi maksimizirali učinak svoje kompanije.</p>
                                
                                <h5>Ključne karakteristike:</h5>
                                <ul>
                                    <li>Realistična simulacija industrije pametnih telefona</li>
                                    <li>Podrška za do 5 takmičarskih timova</li>
                                    <li>10 rundi strateškog odlučivanja</li>
                                    <li>Evaluacija učinka pomoću balansirane liste pokazatelja</li>
                                    <li>Dinamični tržišni uslovi i strateški događaji</li>
                                    <li>Primena ključnih strateških okvira</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Game Modal -->
    <div class="modal fade" id="createGameModal" tabindex="-1" aria-labelledby="createGameModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="createGameModalLabel">Kreiraj novu igru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zatvori"></button>
                </div>
                <div class="modal-body">
                    <form id="createGameForm">
                        <div class="mb-3">
                            <label for="numTeams" class="form-label">Broj timova</label>
                            <select class="form-select" id="numTeams" required>
                                <option value="2">2 tima</option>
                                <option value="3">3 tima</option>
                                <option value="4">4 tima</option>
                                <option value="5" selected>5 timova</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="numRounds" class="form-label">Broj rundi</label>
                            <select class="form-select" id="numRounds" required>
                                <option value="5">5 rundi</option>
                                <option value="8">8 rundi</option>
                                <option value="10" selected>10 rundi</option>
                                <option value="12">12 rundi</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success w-100">Kreiraj igru</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Join as Admin Modal -->
    <div class="modal fade" id="joinAdminModal" tabindex="-1" aria-labelledby="joinAdminModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="joinAdminModalLabel">Pridruži se kao voditelj</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zatvori"></button>
                </div>
                <div class="modal-body">
                    <form id="joinAdminForm">
                        <div class="mb-3">
                            <label for="adminGameId" class="form-label">ID igre</label>
                            <input type="text" class="form-control" id="adminGameId" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminCode" class="form-label">Admin kod</label>
                            <input type="text" class="form-control" id="adminCode" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100">Pridruži se igri</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Join as Team Modal -->
    <div class="modal fade" id="joinTeamModal" tabindex="-1" aria-labelledby="joinTeamModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="joinTeamModalLabel">Pridruži se kao tim</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zatvori"></button>
                </div>
                <div class="modal-body">
                    <form id="joinTeamForm">
                        <div class="mb-3">
                            <label for="teamGameId" class="form-label">ID igre</label>
                            <input type="text" class="form-control" id="teamGameId" required>
                        </div>
                        <div class="mb-3">
                            <label for="teamId" class="form-label">ID tima</label>
                            <input type="text" class="form-control" id="teamId" required>
                        </div>
                        <div class="mb-3">
                            <label for="teamCode" class="form-label">Kod tima</label>
                            <input type="text" class="form-control" id="teamCode" required>
                        </div>
                        <button type="submit" class="btn btn-info w-100">Pridruži se igri</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Created Success Modal -->
    <div class="modal fade" id="gameCreatedModal" tabindex="-1" aria-labelledby="gameCreatedModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="gameCreatedModalLabel">Igra uspešno kreirana</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zatvori"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <strong>Važno:</strong> Sačuvajte ove informacije! Biće vam potrebni ovi kodovi za pristup igri.
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>ID igre:</strong></label>
                        <input type="text" class="form-control" id="createdGameId" readonly>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>Admin kod:</strong></label>
                        <input type="text" class="form-control" id="createdAdminCode" readonly>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>Kodovi timova:</strong></label>
                        <div id="teamCodesList" class="list-group"></div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" id="goToAdminDashboard">Idi na admin kontrolnu tablu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Create Game Form Submission
            document.getElementById('createGameForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const numTeams = document.getElementById('numTeams').value;
                const numRounds = document.getElementById('numRounds').value;
                
                fetch('/create_game', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        num_teams: parseInt(numTeams),
                        num_rounds: parseInt(numRounds)
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    // Hide create game modal
                    const createModal = bootstrap.Modal.getInstance(document.getElementById('createGameModal'));
                    createModal.hide();
                    
                    // Populate success modal
                    document.getElementById('createdGameId').value = data.game_id;
                    document.getElementById('createdAdminCode').value = data.admin_code;
                    
                    const teamCodesList = document.getElementById('teamCodesList');
                    teamCodesList.innerHTML = '';
                    
                    for (const [teamId, code] of Object.entries(data.team_codes)) {
                        const listItem = document.createElement('div');
                        listItem.className = 'list-group-item';
                        listItem.innerHTML = `<strong>${teamId}:</strong> ${code}`;
                        teamCodesList.appendChild(listItem);
                    }
                    
                    // Set up admin dashboard button
                    document.getElementById('goToAdminDashboard').onclick = function() {
                        window.location.href = `/admin/${data.game_id}?admin_code=${data.admin_code}`;
                    };
                    
                    // Show success modal
                    const successModal = new bootstrap.Modal(document.getElementById('gameCreatedModal'));
                    successModal.show();
                })
                .catch(error => {
                    console.error('Greška pri kreiranju igre:', error);
                    alert('Greška pri kreiranju igre. Molimo pokušajte ponovo.');
                });
            });
            
            // Join Admin Form Submission
            document.getElementById('joinAdminForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const gameId = document.getElementById('adminGameId').value;
                const adminCode = document.getElementById('adminCode').value;
                
                fetch('/join_game', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        game_id: gameId,
                        role: 'admin',
                        code: adminCode
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    if (data.redirect) {
                        window.location.href = data.redirect;
                    } else {
                        throw new Error('Nije primljen URL za preusmeravanje');
                    }
                })
                .catch(error => {
                    console.error('Greška pri pridruživanju igri:', error);
                    alert('Greška pri pridruživanju igri: ' + error.message);
                });
            });
            
            // Join Team Form Submission
            document.getElementById('joinTeamForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const gameId = document.getElementById('teamGameId').value;
                const teamId = document.getElementById('teamId').value;
                const teamCode = document.getElementById('teamCode').value;
                
                fetch('/join_game', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        game_id: gameId,
                        role: 'team',
                        code: teamCode
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    if (data.redirect) {
                        window.location.href = data.redirect;
                    } else {
                        throw new Error('Nije primljen URL za preusmeravanje');
                    }
                })
                .catch(error => {
                    console.error('Greška pri pridruživanju igri:', error);
                    alert('Greška pri pridruživanju igri: ' + error.message);
                });
            });
        });
    </script>
</body>
</html>
